!function(a,b){"function"==typeof define&&define.amd?define(function(){return b(a)}):"object"==typeof exports?module.exports=b:a.echo=b(a)}(this,function(b){"use strict";var c,d,e,f,g,a={},h=function(){},i=function(c,a){if(null===c.offsetParent)return!1;var d,b=c.getBoundingClientRect();return b.right>=a.l&&b.bottom>=a.t&&b.left<=a.r&&b.top<=a.b},j=function(){(f||!d)&&(clearTimeout(d),d=setTimeout(function(){a.render(),d=null},e))};return a.init=function(d){var k=(d=d||{}).offset||0,l=d.offsetVertical||k,m=d.offsetHorizontal||k,i=function(a,b){return parseInt(a||b,10)};c={t:i(d.offsetTop,l),b:i(d.offsetBottom,l),l:i(d.offsetLeft,m),r:i(d.offsetRight,m)},e=i(d.throttle,250),f=!1!==d.debounce,g=!!d.unload,h=d.callback||h,a.render(),document.addEventListener?(b.addEventListener("scroll",j,!1),b.addEventListener("load",j,!1)):(b.attachEvent("onscroll",j),b.attachEvent("onload",j))},a.render=function(l){for(var e,d,j=(l||document).querySelectorAll("[data-echo], [data-echo-background]"),k=j.length,m={l:0-c.l,t:0-c.t,b:(b.innerHeight||document.documentElement.clientHeight)+c.b,r:(b.innerWidth||document.documentElement.clientWidth)+c.r},f=0;f<k;f++)i(d=j[f],m)?(g&&d.setAttribute("data-echo-placeholder",d.src),null!==d.getAttribute("data-echo-background")?d.style.backgroundImage="url("+d.getAttribute("data-echo-background")+")":d.src!==(e=d.getAttribute("data-echo"))&&(d.src=e),g||(d.removeAttribute("data-echo"),d.removeAttribute("data-echo-background")),h(d,"load")):g&&(e=d.getAttribute("data-echo-placeholder"))&&(null!==d.getAttribute("data-echo-background")?d.style.backgroundImage="url("+e+")":d.src=e,d.removeAttribute("data-echo-placeholder"),h(d,"unload"));k||a.detach()},a.detach=function(){document.removeEventListener?b.removeEventListener("scroll",j):b.detachEvent("onscroll",j),clearTimeout(d)},a})